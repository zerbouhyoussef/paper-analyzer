groups:
  - name: api_alerts
    rules:
      - alert: HighRequestLatency
        expr: histogram_quantile(0.95, rate(api_request_duration_seconds_bucket[5m])) > 2
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "API p95 latency above 2s"
          description: "The 95th percentile request latency is {{ $value }}s over the last 5 minutes."

      - alert: HighErrorRate
        expr: sum(rate(api_requests_total{status=~"5.."}[5m])) / sum(rate(api_requests_total[5m])) > 0.05
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "API error rate above 5%"
          description: "{{ $value | humanizePercentage }} of requests are returning 5xx errors."

      - alert: APIDown
        expr: up{job="api"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "API service is down"
          description: "The API service has been unreachable for more than 1 minute."

      - alert: SearchLatencyHigh
        expr: histogram_quantile(0.95, rate(api_search_duration_seconds_bucket[5m])) > 5
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Search p95 latency above 5s"
          description: "Semantic search is taking {{ $value }}s at the 95th percentile."

      - alert: NoPapersLoaded
        expr: api_papers_loaded_total == 0
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "No papers loaded in API"
          description: "The API store has 0 papers loaded for over 10 minutes."
